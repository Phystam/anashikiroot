
// BigRIPS/SAMURAI reconstruction class
// by T.Tomai
// this is a singleton class

#ifndef _TARTEASYPID_H_
#define _TARTEASYPID_H_

#include <TNamed.h>
#include <TClonesArray.h>

#include "TArtReconstruction.hh"

class TArtBigRIPSParameters;
class TArtCalibPlastic;
class TArtPlastic;
class TArtCalibIC;
class TArtIC;
class TArtStoreManager;
class TArtShikiParameters;
class TArtEasyTarget;


class TArtEasyPID : public TArtReconstruction{

private:

  TArtEasyPID(Double_t Brho0 = 7.6478);
  //TArtEasyPID();

public:
  virtual ~TArtEasyPID();
  //シングルトンアクセス用
  static TArtEasyPID* Instance(Double_t Brho0 = 7.6478);
  //  void Initialize();
  void ClearData();
  void ReconstructData();
  Bool_t IsRejected(){return frejected_f3||frejected_f5||frejected_f7||frejected_tof;}
  Bool_t IsRejected_F3(){return frejected_f3;}
  Bool_t IsRejected_F5(){return frejected_f5;}
  Bool_t IsRejected_F7(){return frejected_f7;}
  Bool_t IsRejected_TOF(){return frejected_tof;}
  Double_t GetBrho0(){return fBrho0;} 
  Double_t GetBrho(){return fBrho;} 
  Double_t GetTOF713(){return fTOF713;} 
  Double_t GetTOF37(){return fTOF37;} 
  Double_t GetDeltaE(){return fDeltaE;} 
  Double_t GetBeta(){return fBeta;}
  Double_t GetGamma(){return fGamma;}
  Double_t GetZet(){return fZ;}
  Double_t GetAoZ(){return fAoZ;}
  Double_t GetSBTTime(){return ff13Time;}
  //calculation of energy or momentum
  //From TOF
  //TotalEnergy: MeV
  //TotalKineticEnergy: MeV
  //KineticEnergy: MeV/u (not AMeV!!!)
  //TotalMomentum: MeV/c
  //Momentum: MeV/c/u
  Double_t GetTotalEnergyFromTOF(Int_t A,Int_t Z,Double_t mass_excess);//calc from mass
  Double_t GetTotalKineticEnergyFromTOF(Int_t A,Int_t Z,Double_t mass_excess);//calc from mass
  Double_t GetKineticEnergyFromTOF(Int_t A,Int_t Z,Double_t mass_excess);//calc from mass
  Double_t GetKineticEnergyAtTgtFromTOF(Int_t A,Int_t Z,Double_t mass_excess);//calc from mass
  Double_t GetTotalKineticEnergyAtTgtFromTOF(Int_t A,Int_t Z,Double_t mass_excess);//calc from mass
  Double_t GetTotalEnergyAtTgtFromTOF(Int_t A,Int_t Z,Double_t mass_excess);//calc from mass

  Double_t GetTotalMomentumFromTOF(Int_t A,Int_t Z,Double_t mass_excess);//calc from mass
  Double_t GetMomentumFromTOF(Int_t A,Int_t Z,Double_t mass_excess);//calc from mass
  Double_t GetMomentumAtTgtFromTOF(Int_t A,Int_t Z,Double_t mass_excess);//calc from mass
  Double_t GetTotalMomentumAtTgtFromTOF(Int_t A,Int_t Z,Double_t mass_excess);//calc from mass

  //  Double_t GetTotalEnergy(Int_t A,Int_t Z);//calc from beta
  Double_t GetTotalMomentumFromBrho(Int_t A,Int_t Z,Double_t mass_excess);
  Double_t GetMomentumFromBrho(Int_t A,Int_t Z,Double_t mass_excess);
  Double_t GetMomentumAtTgtFromBrho(Int_t A,Int_t Z,Double_t mass_excess);
  Double_t GetTotalMomentumAtTgtFromBrho(Int_t A,Int_t Z,Double_t mass_excess);

  Double_t GetTotalEnergyFromBrho(Int_t A,Int_t Z,Double_t mass_excess);
  Double_t GetTotalKineticEnergyFromBrho(Int_t A,Int_t Z,Double_t mass_excess);
  Double_t GetKineticEnergyFromBrho(Int_t A,Int_t Z,Double_t mass_excess);
  Double_t GetTotalKineticEnergyAtTgtFromBrho(Int_t A,Int_t Z,Double_t mass_excess);
  Double_t GetKineticEnergyAtTgtFromBrho(Int_t A,Int_t Z,Double_t mass_excess);
  Double_t GetTotalEnergyAtTgtFromBrho(Int_t A,Int_t Z,Double_t mass_excess);
  //alias
  Double_t GetTotalEnergy            (Int_t A,Int_t Z,Double_t mass_excess){return GetTotalEnergyFromTOF            (A,Z,mass_excess);}
  Double_t GetTotalKineticEnergy     (Int_t A,Int_t Z,Double_t mass_excess){return GetTotalKineticEnergyFromTOF     (A,Z,mass_excess);}
  Double_t GetKineticEnergy          (Int_t A,Int_t Z,Double_t mass_excess){return GetKineticEnergyFromTOF          (A,Z,mass_excess);}
  Double_t GetKineticEnergyAtTgt     (Int_t A,Int_t Z,Double_t mass_excess){return GetKineticEnergyAtTgtFromTOF     (A,Z,mass_excess);}
  Double_t GetTotalKineticEnergyAtTgt(Int_t A,Int_t Z,Double_t mass_excess){return GetTotalKineticEnergyAtTgtFromTOF(A,Z,mass_excess);}
  Double_t GetTotalEnergyAtTgt       (Int_t A,Int_t Z,Double_t mass_excess){return GetTotalEnergyAtTgtFromTOF       (A,Z,mass_excess);}

  Double_t GetTotalMomentum          (Int_t A,Int_t Z,Double_t mass_excess){return GetTotalMomentumFromTOF          (A,Z,mass_excess);}
  Double_t GetMomentum               (Int_t A,Int_t Z,Double_t mass_excess){return GetMomentumFromTOF               (A,Z,mass_excess);}
  Double_t GetMomentumAtTgt          (Int_t A,Int_t Z,Double_t mass_excess){return GetMomentumAtTgtFromTOF          (A,Z,mass_excess);}
  Double_t GetTotalMomentumAtTgt     (Int_t A,Int_t Z,Double_t mass_excess){return GetTotalMomentumAtTgtFromTOF     (A,Z,mass_excess);}

  Double_t E2Tgt(Double_t E);
  Double_t GetTOFSBTTgt(Int_t A,Int_t Z,Double_t mass_excess);
  void SetBrho0(Double_t val){fBrho0=val;} 
  void SetBrho(Double_t val){fBrho=val;} 
  void SetTOF713(Double_t val){fTOF713=val;} 
  void SetTOF37(Double_t val){fTOF37=val;} 
  void SetDeltaE(Double_t val){fDeltaE=val;} 
  void SetBeta(Double_t val){fBeta=val;}
  void SetGamma(Double_t val){fGamma=val;}
  void SetZet(Double_t val){fZ=val;}
  void SetAoZ(Double_t val){fAoZ=val;}

  void SetPlastic(Int_t index,TArtPlastic* pl){fpla[index]=pl;}
  void SetICB(TArtIC* ic){ficb=ic;}
  TArtPlastic* GetPlastic(Int_t id){return fpla[id-1];}
  TArtIC* GetICB(){return ficb;}
  // function to access data container

  void SelectTarget(TString name);
  void SelectTarget(Int_t ID);
 private:

  // pointer to subsystem objects used for PID
  TArtCalibPlastic* fcalibpla;
  TArtCalibIC* fcalibic;

  TArtPlastic* fpla[7];  
  TArtIC* ficb;

  Double_t fBrho0;
  Double_t fBrho;
  Double_t fTOF37;
  Double_t fTOF713;
  Double_t fDeltaE;
  Double_t fBeta;
  Double_t fGamma;
  Double_t fZ;
  Double_t fAoZ;
  Double_t ff13Time;
  Bool_t frejected_f3,frejected_f5,frejected_f7,frejected_tof;
  Bool_t freconstructed;
  TArtStoreManager* sman;
  const TArtShikiParameters* fshikipara;
  TArtEasyTarget* feasytarget;
  static const Double_t fclight=2.99792458e8;// m/s
  static const Double_t fe=1.6021766208e-19;// C
  static const Double_t famu=1.660538921e-27;// kg
  static const Double_t famu_MeV=931.494061;//MeV

  ClassDef(TArtEasyPID,1);


};

#endif
